import{S as X,i as W,s as T,C as J,e as C,O as F,t as le,c as D,a as z,P as V,d as w,h as fe,b as c,f as A,a1 as x,I as K,g as H,J as k,Q as ke,z as Ee,E as j,a2 as I,a3 as Pe,a4 as ze,k as q,m as O,j as Le,K as Me,R as Be,v as ce,a5 as Ce,a6 as ue,l as $,n as he,o as N,p as me,w as de,x as pe,y as ge,q as B,B as _e,_ as De,a7 as Ze,a8 as ee,X as Ne,Y as Se,Z as Fe,N as S,a9 as Ve,aa as te}from"./index-bbca5c05.js";import{d as Ge,w as Re}from"./index-236d7f9e.js";import{d as qe,m as se,e as re,f as Oe,a as He,b as je,c as Ae,g as ae}from"./Map.svelte_svelte_type_style_lang-00527014.js";import{e as Ke,s as Qe}from"./index-d82f60b1.js";function Te(r,t,e){e===void 0&&(e={});var s={type:"Feature"};return(e.id===0||e.id)&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.properties=t||{},s.geometry=r,s}function Ue(r,t,e){e===void 0&&(e={});for(var s=0,a=r;s<a.length;s++){var i=a[s];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:r};return Te(l,t,e)}function Ye(r,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=r,e}function ve(r,t,e){if(r!==null)for(var s,a,i,o,l,n,d,b=0,m=0,f,_=r.type,p=_==="FeatureCollection",u=_==="Feature",y=p?r.features.length:1,v=0;v<y;v++){d=p?r.features[v].geometry:u?r.geometry:r,f=d?d.type==="GeometryCollection":!1,l=f?d.geometries.length:1;for(var E=0;E<l;E++){var P=0,M=0;if(o=f?d.geometries[E]:d,o!==null){n=o.coordinates;var L=o.type;switch(b=e&&(L==="Polygon"||L==="MultiPolygon")?1:0,L){case null:break;case"Point":if(t(n,m,v,P,M)===!1)return!1;m++,P++;break;case"LineString":case"MultiPoint":for(s=0;s<n.length;s++){if(t(n[s],m,v,P,M)===!1)return!1;m++,L==="MultiPoint"&&P++}L==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(s=0;s<n.length;s++){for(a=0;a<n[s].length-b;a++){if(t(n[s][a],m,v,P,M)===!1)return!1;m++}L==="MultiLineString"&&P++,L==="Polygon"&&M++}L==="Polygon"&&P++;break;case"MultiPolygon":for(s=0;s<n.length;s++){for(M=0,a=0;a<n[s].length;a++){for(i=0;i<n[s][a].length-b;i++){if(t(n[s][a][i],m,v,P,M)===!1)return!1;m++}M++}P++}break;case"GeometryCollection":for(s=0;s<o.geometries.length;s++)if(ve(o.geometries[s],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(r){var t=[1/0,1/0,-1/0,-1/0];return ve(r,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}Q.default=Q;function Je(r,t){t===void 0&&(t={});var e=Number(r[0]),s=Number(r[1]),a=Number(r[2]),i=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[e,s],l=[e,i],n=[a,i],d=[a,s];return Ue([[o,d,n,l,o]],t.properties,{bbox:r,id:t.id})}function Xe(r){let t,e,s,a,i,o,l=`rotate(${r[1]}deg)`,n,d,b=[r[2]],m={};for(let f=0;f<b.length;f+=1)m=J(m,b[f]);return{c(){t=C("div"),e=F("svg"),s=F("path"),a=F("path"),i=F("text"),o=le("N"),this.h()},l(f){t=D(f,"DIV",{});var _=z(t);e=V(_,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,preserveAspectRatio:!0,class:!0});var p=z(e);s=V(p,"path",{"vector-effect":!0,d:!0,class:!0}),z(s).forEach(w),a=V(p,"path",{d:!0,id:!0,class:!0}),z(a).forEach(w),i=V(p,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var u=z(i);o=fe(u,"N"),u.forEach(w),p.forEach(w),_.forEach(w),this.h()},h(){c(s,"vector-effect","non-scaling-stroke"),c(s,"d","M35,50 L50,95 65,50Z"),c(s,"class","cpeum-1j5xfwi"),c(a,"d","M35,50 L50,5 65,50Z"),c(a,"id","north"),c(a,"class","cpeum-1j5xfwi"),c(i,"x","50"),c(i,"y","0"),c(i,"text-anchor","middle"),c(i,"class","cpeum-1j5xfwi"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","100"),c(e,"height","100"),c(e,"viewBox","0 0 100 100"),c(e,"preserveAspectRatio","xMidYMid"),c(e,"class","cpeum-1j5xfwi"),A(e,"transform",l,!1),x(t,m),A(t,"--size",r[0],!1),K(t,"cpeum-1j5xfwi",!0)},m(f,_){H(f,t,_),k(t,e),k(e,s),k(e,a),k(e,i),k(i,o),n||(d=ke(t,"click",r[3]),n=!0)},p(f,[_]){_&2&&l!==(l=`rotate(${f[1]}deg)`)&&A(e,"transform",l,!1),x(t,m=Ee(b,[_&4&&f[2]])),A(t,"--size",f[0],!1),K(t,"cpeum-1j5xfwi",!0)},i:j,o:j,d(f){f&&w(t),n=!1,d()}}}function We(r,t,e){const s=["size","bearing"];let a=I(t,s),{size:i="40px"}=t,{bearing:o}=t;function l(n){ze.call(this,r,n)}return r.$$set=n=>{t=J(J({},t),Pe(n)),e(2,a=I(t,s)),"size"in n&&e(0,i=n.size),"bearing"in n&&e(1,o=n.bearing)},[i,o,a,l]}class xe extends X{constructor(t){super(),W(this,t,We,Xe,T,{size:0,bearing:1})}}function Ie(r){let t,e,s,a,i,o,l,n;return{c(){t=C("div"),e=C("div"),s=C("div"),a=le(r[0]),i=q(),o=F("svg"),l=F("path"),this.h()},l(d){t=D(d,"DIV",{id:!0,class:!0});var b=z(t);e=D(b,"DIV",{id:!0,class:!0});var m=z(e);s=D(m,"DIV",{id:!0,class:!0});var f=z(s);a=fe(f,r[0]),f.forEach(w),i=O(m),o=V(m,"svg",{id:!0,viewBox:!0,width:!0,height:!0,class:!0});var _=z(o);l=V(_,"path",{d:!0,class:!0}),z(l).forEach(w),_.forEach(w),m.forEach(w),b.forEach(w),this.h()},h(){c(s,"id","content"),c(s,"class","cpeum-1mzxy9c"),c(l,"d","M 0,0 C 5,0 10,20 15,20 C 20,20 25,0 30,0 Z"),c(l,"class","cpeum-1mzxy9c"),c(o,"id","pin"),c(o,"viewBox","0 0 30 20"),c(o,"width","30"),c(o,"height","20"),c(o,"class","cpeum-1mzxy9c"),c(e,"id","inner"),c(e,"class","cpeum-1mzxy9c"),c(t,"id","wrap"),c(t,"class","cpeum-1mzxy9c")},m(d,b){H(d,t,b),k(t,e),k(e,s),k(s,a),k(e,i),k(e,o),k(o,l),r[4](t)},p(d,[b]){r=d,b&1&&Le(a,r[0])},i(d){n||Me(()=>{n=Be(e,Qe,{start:.8,opacity:0,duration:250,easing:Ke}),n.start()})},o:j,d(d){d&&w(t),r[4](null)}}}function $e(r,t,e){let{map:s}=t,{text:a}=t,{coords:i}=t,o;ce(()=>{new qe.exports.Marker({element:o,anchor:"bottom"}).setLngLat(i).addTo(s)}),Ce(()=>{});function l(n){ue[n?"unshift":"push"](()=>{o=n,e(1,o)})}return r.$$set=n=>{"map"in n&&e(2,s=n.map),"text"in n&&e(0,a=n.text),"coords"in n&&e(3,i=n.coords)},[a,o,s,i,l]}class et extends X{constructor(t){super(),W(this,t,$e,Ie,T,{map:2,text:0,coords:3})}}function ie(r){let t=r[3],e,s,a=oe(r);return{c(){a.c(),e=$()},l(i){a.l(i),e=$()},m(i,o){a.m(i,o),H(i,e,o),s=!0},p(i,o){o&8&&T(t,t=i[3])?(he(),N(a,1,1,j),me(),a=oe(i),a.c(),B(a),a.m(e.parentNode,e)):a.p(i,o)},i(i){s||(B(a),s=!0)},o(i){N(a),s=!1},d(i){i&&w(e),a.d(i)}}}function oe(r){let t,e;return t=new et({props:{map:g,text:r[3].text,coords:r[3].coords}}),{c(){de(t.$$.fragment)},l(s){pe(t.$$.fragment,s)},m(s,a){ge(t,s,a),e=!0},p(s,a){const i={};a&0&&(i.map=g),a&8&&(i.text=s[3].text),a&8&&(i.coords=s[3].coords),t.$set(i)},i(s){e||(B(t.$$.fragment,s),e=!0)},o(s){N(t.$$.fragment,s),e=!1},d(s){_e(t,s)}}}function tt(r){let t,e,s,a,i,o,l,n,d,b,m,f=r[3]&&ie(r);n=new xe({props:{bearing:r[1]}}),n.$on("click",r[4]);const _=r[12].default,p=De(_,r,r[11],null);return{c(){t=C("link"),e=q(),s=C("figure"),f&&f.c(),a=q(),i=C("div"),o=q(),l=C("div"),de(n.$$.fragment),d=q(),p&&p.c(),this.h()},l(u){const y=Ze('[data-svelte="svelte-1yi8k0v"]',document.head);t=D(y,"LINK",{rel:!0,href:!0}),y.forEach(w),e=O(u),s=D(u,"FIGURE",{class:!0});var v=z(s);f&&f.l(v),a=O(v),i=D(v,"DIV",{id:!0,class:!0}),z(i).forEach(w),o=O(v),l=D(v,"DIV",{id:!0,class:!0});var E=z(l);pe(n.$$.fragment,E),d=O(E),p&&p.l(E),E.forEach(w),v.forEach(w),this.h()},h(){c(t,"rel","stylesheet"),c(t,"href","https://unpkg.com/maplibre-gl@2.1.7/dist/maplibre-gl.css"),c(i,"id","container"),c(i,"class","cpeum-9aesfo"),c(l,"id","info"),c(l,"class","cpeum-9aesfo"),c(s,"class",b=ee(r[2].class)+" cpeum-9aesfo"),K(s,"full",r[2].full)},m(u,y){k(document.head,t),H(u,e,y),H(u,s,y),f&&f.m(s,null),k(s,a),k(s,i),r[13](i),k(s,o),k(s,l),ge(n,l,null),k(l,d),p&&p.m(l,null),m=!0},p(u,[y]){u[3]?f?(f.p(u,y),y&8&&B(f,1)):(f=ie(u),f.c(),B(f,1),f.m(s,a)):f&&(he(),N(f,1,1,()=>{f=null}),me());const v={};y&2&&(v.bearing=u[1]),n.$set(v),p&&p.p&&(!m||y&2048)&&Ne(p,_,u,u[11],m?Fe(_,u[11],y,null):Se(u[11]),null),(!m||y&4&&b!==(b=ee(u[2].class)+" cpeum-9aesfo"))&&c(s,"class",b),y&4&&K(s,"full",u[2].full)},i(u){m||(B(f),B(n.$$.fragment,u),B(p,u),m=!0)},o(u){N(f),N(n.$$.fragment,u),N(p,u),m=!1},d(u){w(t),u&&w(e),u&&w(s),f&&f.d(),r[13](null),_e(n),p&&p.d(u)}}}const ne=Re(!1);let g;function Y(r,t){for(const e of r)g.setFeatureState({source:"propositions",id:e},{highlight:t})}function st(r,t,e){let s,a,i=j,o,l,n,d;S(r,He,h=>e(7,s=h)),S(r,ne,h=>e(8,a=h)),S(r,je,h=>e(10,l=h)),S(r,se,h=>e(2,n=h)),S(r,Ae,h=>e(3,d=h)),r.$$.on_destroy.push(()=>i());let{$$slots:b={},$$scope:m}=t;const f=Ve();let _,p=0,u=0,y=20,v=14,E;function P(){g.flyTo({center:E,pitch:y,zoom:v,bearing:u})}function M(){e(1,p=0),g.flyTo({bearing:0})}const L=Ge(se,h=>h.full);S(r,L,h=>e(9,o=h));let Z;ce(()=>{g=new re.Map({container:_,style:"https://api.maptiler.com/maps/856b4e05-cd2c-42db-9453-9cd7e156a083/style.json?key=dtV5LH1SmQB4VOb80qqI",bounds:Oe.fallback,fitBoundsOptions:{padding:100},bearing:p,pitch:y,zoom:v,minZoom:10,maxZoom:20}),g.on("error",h=>{f("error")}),g.once("load",()=>{ne.set(!0),f("load"),e(1,p=g.getBearing()),y=g.getPitch(),v=g.getZoom(),E=g.getCenter()}),g.on("rotate",h=>{e(1,p=g.getBearing()),h.originalEvent&&(u=g.getBearing())}),g.on("pitchend",h=>{h.originalEvent&&(y=g.getPitch())}),g.on("zoomend",h=>{h.originalEvent&&(v=g.getZoom(),E=g.getCenter())}),g.on("dragend",h=>{E=g.getCenter()})});function be(h){ue[h?"unshift":"push"](()=>{_=h,e(0,_)})}return r.$$set=h=>{"$$scope"in h&&e(11,m=h.$$scope)},r.$$.update=()=>{if(r.$$.dirty&1792&&a&&!o){if(!l)P();else if(l.bounds)g.fitBounds(l.bounds,{bearing:0,pitch:l.pitch!==void 0&&l.pitch!==null?l.pitch:20,duration:350});else if(l.center)g.flyTo({center:l.center.point,zoom:l.center.zoom,bearing:0,pitch:20,duration:350});else if(l.filter){const h=Object.entries(l.filter),G=te(ae).filter(R=>h.every(([ye,we])=>R.properties[ye]===we)),U=new re.LngLatBounds(Q(Ye(G.map(R=>Je(Q(R))))));g.fitBounds(U,{padding:200,maxZoom:15})}}if(r.$$.dirty&768&&a&&o&&P(),r.$$.dirty&448&&a)if(s){Z&&Y(Z,!1);const h=Object.entries(s);e(6,Z=te(ae).filter(G=>h.every(([U,R])=>G.properties[U]===R)).map(G=>G.id)),Y(Z,!0)}else Z&&Y(Z,!1)},[_,p,n,d,M,L,Z,s,a,o,l,m,b,be]}class nt extends X{constructor(t){super(),W(this,t,st,tt,T,{})}}export{xe as F,nt as M,g as a,ne as m};
