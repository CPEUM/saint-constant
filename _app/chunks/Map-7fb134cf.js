import{S as J,i as X,s as Q,C as Y,e as C,O as S,t as le,c as q,a as L,P as Z,d as w,h as ne,b as c,f as j,a1 as W,I as A,g as O,J as k,Q as we,z as ke,E as H,a2 as x,a3 as Ee,a4 as Le,k as G,m as R,j as Me,K as Pe,R as ze,v as fe,a5 as Be,a6 as ce,l as I,n as ue,o as D,p as me,w as he,x as de,y as pe,q as B,B as ge,_ as Ce,a7 as qe,a8 as $,X as De,Y as Ne,Z as Se,N,a9 as Ze,aa as ee}from"./index-bbca5c05.js";import{d as Ve,w as Fe}from"./index-236d7f9e.js";import{d as Ge,a as Re,b as Oe,m as te,c as He,e as se,f as re}from"./maplibre-gl-05c428df.js";import{b as je}from"./Map.svelte_svelte_type_style_lang-a346c26e.js";import{e as Ae,s as Ke}from"./index-d82f60b1.js";function Qe(r,t,e){e===void 0&&(e={});var s={type:"Feature"};return(e.id===0||e.id)&&(s.id=e.id),e.bbox&&(s.bbox=e.bbox),s.properties=t||{},s.geometry=r,s}function Te(r,t,e){e===void 0&&(e={});for(var s=0,a=r;s<a.length;s++){var i=a[s];if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<i[i.length-1].length;o++)if(i[i.length-1][o]!==i[0][o])throw new Error("First and last Position are not equivalent.")}var f={type:"Polygon",coordinates:r};return Qe(f,t,e)}function Ue(r,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=r,e}function _e(r,t,e){if(r!==null)for(var s,a,i,o,f,l,p,b=0,h=0,n,_=r.type,d=_==="FeatureCollection",u=_==="Feature",y=d?r.features.length:1,v=0;v<y;v++){p=d?r.features[v].geometry:u?r.geometry:r,n=p?p.type==="GeometryCollection":!1,f=n?p.geometries.length:1;for(var P=0;P<f;P++){var M=0,z=0;if(o=n?p.geometries[P]:p,o!==null){l=o.coordinates;var E=o.type;switch(b=e&&(E==="Polygon"||E==="MultiPolygon")?1:0,E){case null:break;case"Point":if(t(l,h,v,M,z)===!1)return!1;h++,M++;break;case"LineString":case"MultiPoint":for(s=0;s<l.length;s++){if(t(l[s],h,v,M,z)===!1)return!1;h++,E==="MultiPoint"&&M++}E==="LineString"&&M++;break;case"Polygon":case"MultiLineString":for(s=0;s<l.length;s++){for(a=0;a<l[s].length-b;a++){if(t(l[s][a],h,v,M,z)===!1)return!1;h++}E==="MultiLineString"&&M++,E==="Polygon"&&z++}E==="Polygon"&&M++;break;case"MultiPolygon":for(s=0;s<l.length;s++){for(z=0,a=0;a<l[s].length;a++){for(i=0;i<l[s][a].length-b;i++){if(t(l[s][a][i],h,v,M,z)===!1)return!1;h++}z++}M++}break;case"GeometryCollection":for(s=0;s<o.geometries.length;s++)if(_e(o.geometries[s],t,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function K(r){var t=[1/0,1/0,-1/0,-1/0];return _e(r,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}K.default=K;function Ye(r,t){t===void 0&&(t={});var e=Number(r[0]),s=Number(r[1]),a=Number(r[2]),i=Number(r[3]);if(r.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[e,s],f=[e,i],l=[a,i],p=[a,s];return Te([[o,p,l,f,o]],t.properties,{bbox:r,id:t.id})}function Je(r){let t,e,s,a,i,o,f=`rotate(${r[1]}deg)`,l,p,b=[r[2]],h={};for(let n=0;n<b.length;n+=1)h=Y(h,b[n]);return{c(){t=C("div"),e=S("svg"),s=S("path"),a=S("path"),i=S("text"),o=le("N"),this.h()},l(n){t=q(n,"DIV",{});var _=L(t);e=Z(_,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,preserveAspectRatio:!0,class:!0});var d=L(e);s=Z(d,"path",{"vector-effect":!0,d:!0,class:!0}),L(s).forEach(w),a=Z(d,"path",{d:!0,id:!0,class:!0}),L(a).forEach(w),i=Z(d,"text",{x:!0,y:!0,"text-anchor":!0,class:!0});var u=L(i);o=ne(u,"N"),u.forEach(w),d.forEach(w),_.forEach(w),this.h()},h(){c(s,"vector-effect","non-scaling-stroke"),c(s,"d","M35,50 L50,95 65,50Z"),c(s,"class","cpeum-1j5xfwi"),c(a,"d","M35,50 L50,5 65,50Z"),c(a,"id","north"),c(a,"class","cpeum-1j5xfwi"),c(i,"x","50"),c(i,"y","0"),c(i,"text-anchor","middle"),c(i,"class","cpeum-1j5xfwi"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"width","100"),c(e,"height","100"),c(e,"viewBox","0 0 100 100"),c(e,"preserveAspectRatio","xMidYMid"),c(e,"class","cpeum-1j5xfwi"),j(e,"transform",f,!1),W(t,h),j(t,"--size",r[0],!1),A(t,"cpeum-1j5xfwi",!0)},m(n,_){O(n,t,_),k(t,e),k(e,s),k(e,a),k(e,i),k(i,o),l||(p=we(t,"click",r[3]),l=!0)},p(n,[_]){_&2&&f!==(f=`rotate(${n[1]}deg)`)&&j(e,"transform",f,!1),W(t,h=ke(b,[_&4&&n[2]])),j(t,"--size",n[0],!1),A(t,"cpeum-1j5xfwi",!0)},i:H,o:H,d(n){n&&w(t),l=!1,p()}}}function Xe(r,t,e){const s=["size","bearing"];let a=x(t,s),{size:i="40px"}=t,{bearing:o}=t;function f(l){Le.call(this,r,l)}return r.$$set=l=>{t=Y(Y({},t),Ee(l)),e(2,a=x(t,s)),"size"in l&&e(0,i=l.size),"bearing"in l&&e(1,o=l.bearing)},[i,o,a,f]}class We extends J{constructor(t){super(),X(this,t,Xe,Je,Q,{size:0,bearing:1})}}function xe(r){let t,e,s,a,i,o,f,l;return{c(){t=C("div"),e=C("div"),s=C("div"),a=le(r[0]),i=G(),o=S("svg"),f=S("path"),this.h()},l(p){t=q(p,"DIV",{id:!0,class:!0});var b=L(t);e=q(b,"DIV",{id:!0,class:!0});var h=L(e);s=q(h,"DIV",{id:!0,class:!0});var n=L(s);a=ne(n,r[0]),n.forEach(w),i=R(h),o=Z(h,"svg",{id:!0,viewBox:!0,width:!0,height:!0,class:!0});var _=L(o);f=Z(_,"path",{d:!0,class:!0}),L(f).forEach(w),_.forEach(w),h.forEach(w),b.forEach(w),this.h()},h(){c(s,"id","content"),c(s,"class","cpeum-1mzxy9c"),c(f,"d","M 0,0 C 5,0 10,20 15,20 C 20,20 25,0 30,0 Z"),c(f,"class","cpeum-1mzxy9c"),c(o,"id","pin"),c(o,"viewBox","0 0 30 20"),c(o,"width","30"),c(o,"height","20"),c(o,"class","cpeum-1mzxy9c"),c(e,"id","inner"),c(e,"class","cpeum-1mzxy9c"),c(t,"id","wrap"),c(t,"class","cpeum-1mzxy9c")},m(p,b){O(p,t,b),k(t,e),k(e,s),k(s,a),k(e,i),k(e,o),k(o,f),r[4](t)},p(p,[b]){r=p,b&1&&Me(a,r[0])},i(p){l||Pe(()=>{l=ze(e,Ke,{start:.8,opacity:0,duration:250,easing:Ae}),l.start()})},o:H,d(p){p&&w(t),r[4](null)}}}function Ie(r,t,e){let{map:s}=t,{text:a}=t,{coords:i}=t,o;fe(()=>{new Ge.exports.Marker({element:o,anchor:"bottom"}).setLngLat(i).addTo(s)}),Be(()=>{});function f(l){ce[l?"unshift":"push"](()=>{o=l,e(1,o)})}return r.$$set=l=>{"map"in l&&e(2,s=l.map),"text"in l&&e(0,a=l.text),"coords"in l&&e(3,i=l.coords)},[a,o,s,i,f]}class $e extends J{constructor(t){super(),X(this,t,Ie,xe,Q,{map:2,text:0,coords:3})}}function ae(r){let t=r[3],e,s,a=ie(r);return{c(){a.c(),e=I()},l(i){a.l(i),e=I()},m(i,o){a.m(i,o),O(i,e,o),s=!0},p(i,o){o&8&&Q(t,t=i[3])?(ue(),D(a,1,1,H),me(),a=ie(i),a.c(),B(a),a.m(e.parentNode,e)):a.p(i,o)},i(i){s||(B(a),s=!0)},o(i){D(a),s=!1},d(i){i&&w(e),a.d(i)}}}function ie(r){let t,e;return t=new $e({props:{map:g,text:r[3].text,coords:r[3].coords}}),{c(){he(t.$$.fragment)},l(s){de(t.$$.fragment,s)},m(s,a){pe(t,s,a),e=!0},p(s,a){const i={};a&0&&(i.map=g),a&8&&(i.text=s[3].text),a&8&&(i.coords=s[3].coords),t.$set(i)},i(s){e||(B(t.$$.fragment,s),e=!0)},o(s){D(t.$$.fragment,s),e=!1},d(s){ge(t,s)}}}function et(r){let t,e,s,a,i,o,f,l,p,b,h,n=r[3]&&ae(r);l=new We({props:{bearing:r[1]}}),l.$on("click",r[4]);const _=r[12].default,d=Ce(_,r,r[11],null);return{c(){t=C("link"),e=G(),s=C("figure"),n&&n.c(),a=G(),i=C("div"),o=G(),f=C("div"),he(l.$$.fragment),p=G(),d&&d.c(),this.h()},l(u){const y=qe('[data-svelte="svelte-1yi8k0v"]',document.head);t=q(y,"LINK",{rel:!0,href:!0}),y.forEach(w),e=R(u),s=q(u,"FIGURE",{class:!0});var v=L(s);n&&n.l(v),a=R(v),i=q(v,"DIV",{id:!0,class:!0}),L(i).forEach(w),o=R(v),f=q(v,"DIV",{id:!0,class:!0});var P=L(f);de(l.$$.fragment,P),p=R(P),d&&d.l(P),P.forEach(w),v.forEach(w),this.h()},h(){c(t,"rel","stylesheet"),c(t,"href","https://unpkg.com/maplibre-gl@2.1.7/dist/maplibre-gl.css"),c(i,"id","container"),c(i,"class","cpeum-1yg1y5q"),c(f,"id","info"),c(f,"class","cpeum-1yg1y5q"),c(s,"class",b=$(r[2].class)+" cpeum-1yg1y5q"),A(s,"full",r[2].full)},m(u,y){k(document.head,t),O(u,e,y),O(u,s,y),n&&n.m(s,null),k(s,a),k(s,i),r[13](i),k(s,o),k(s,f),pe(l,f,null),k(f,p),d&&d.m(f,null),h=!0},p(u,[y]){u[3]?n?(n.p(u,y),y&8&&B(n,1)):(n=ae(u),n.c(),B(n,1),n.m(s,a)):n&&(ue(),D(n,1,1,()=>{n=null}),me());const v={};y&2&&(v.bearing=u[1]),l.$set(v),d&&d.p&&(!h||y&2048)&&De(d,_,u,u[11],h?Se(_,u[11],y,null):Ne(u[11]),null),(!h||y&4&&b!==(b=$(u[2].class)+" cpeum-1yg1y5q"))&&c(s,"class",b),y&4&&A(s,"full",u[2].full)},i(u){h||(B(n),B(l.$$.fragment,u),B(d,u),h=!0)},o(u){D(n),D(l.$$.fragment,u),D(d,u),h=!1},d(u){w(t),u&&w(e),u&&w(s),n&&n.d(),r[13](null),ge(l),d&&d.d(u)}}}const oe=Fe(!1);let g;function U(r,t){for(const e of r)g.setFeatureState({source:"propositions",id:e},{highlight:t})}function tt(r,t,e){let s,a,i=H,o,f,l,p;N(r,Re,m=>e(7,s=m)),N(r,oe,m=>e(8,a=m)),N(r,Oe,m=>e(10,f=m)),N(r,te,m=>e(2,l=m)),N(r,He,m=>e(3,p=m)),r.$$.on_destroy.push(()=>i());let{$$slots:b={},$$scope:h}=t;const n=Ze();let _,d=0,u=20,y=14,v;function P(){g.flyTo({center:v,pitch:u,zoom:y,bearing:d})}function M(){e(1,d=0),g.flyTo({bearing:0})}const z=Ve(te,m=>m.full);N(r,z,m=>e(9,o=m));let E;fe(()=>{g=new se.Map({container:_,style:"https://api.maptiler.com/maps/856b4e05-cd2c-42db-9453-9cd7e156a083/style.json?key=dtV5LH1SmQB4VOb80qqI",bounds:je.fallback,fitBoundsOptions:{padding:100},bearing:d,pitch:u,zoom:y,minZoom:10,maxZoom:20}),g.on("error",m=>{n("error")}),g.once("load",()=>{oe.set(!0),n("load"),e(1,d=g.getBearing()),u=g.getPitch(),y=g.getZoom(),v=g.getCenter()}),g.on("rotate",m=>{m.originalEvent&&e(1,d=g.getBearing())}),g.on("pitchend",m=>{m.originalEvent&&(u=g.getPitch())}),g.on("zoomend",m=>{m.originalEvent&&(y=g.getZoom(),v=g.getCenter())}),g.on("dragend",m=>{v=g.getCenter()})});function ve(m){ce[m?"unshift":"push"](()=>{_=m,e(0,_)})}return r.$$set=m=>{"$$scope"in m&&e(11,h=m.$$scope)},r.$$.update=()=>{if(r.$$.dirty&1792&&a&&!o){if(!f)P();else if(f.bounds)g.fitBounds(f.bounds,{bearing:0,pitch:20});else if(f.center)g.flyTo({center:f.center.point,zoom:f.center.zoom,bearing:0,pitch:20});else if(f.filter){const m=Object.entries(f.filter),V=ee(re).filter(F=>m.every(([be,ye])=>F.properties[be]===ye)),T=new se.LngLatBounds(K(Ue(V.map(F=>Ye(K(F))))));g.fitBounds(T,{padding:200,maxZoom:15})}}if(r.$$.dirty&768&&a&&o&&P(),r.$$.dirty&448&&a)if(s){E&&U(E,!1);const m=Object.entries(s);e(6,E=ee(re).filter(V=>m.every(([T,F])=>V.properties[T]===F)).map(V=>V.id)),U(E,!0)}else E&&U(E,!1)},[_,d,l,p,M,z,E,s,a,o,f,h,b,ve]}class lt extends J{constructor(t){super(),X(this,t,tt,et,Q,{})}}export{lt as M,g as a,oe as m};
